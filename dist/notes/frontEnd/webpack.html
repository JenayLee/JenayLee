<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | Jenay Lee</title>
    <meta name="description" content="Jenay&#39;s blog">
    <link rel="shortcut icon" type="image/x-icon" href="/JenayLee/images/logo.ico">
    
    <link rel="preload" href="/JenayLee/assets/css/0.styles.fbf7ff69.css" as="style"><link rel="preload" href="/JenayLee/assets/js/app.0b41792d.js" as="script"><link rel="preload" href="/JenayLee/assets/js/19.f0c3d88c.js" as="script"><link rel="prefetch" href="/JenayLee/assets/js/10.c45ce98c.js"><link rel="prefetch" href="/JenayLee/assets/js/11.a370caa2.js"><link rel="prefetch" href="/JenayLee/assets/js/12.1d2cd8e8.js"><link rel="prefetch" href="/JenayLee/assets/js/13.26dde88f.js"><link rel="prefetch" href="/JenayLee/assets/js/14.c023a1f5.js"><link rel="prefetch" href="/JenayLee/assets/js/15.287d77ca.js"><link rel="prefetch" href="/JenayLee/assets/js/16.7f097621.js"><link rel="prefetch" href="/JenayLee/assets/js/17.fe1b6cf8.js"><link rel="prefetch" href="/JenayLee/assets/js/18.5aa963cc.js"><link rel="prefetch" href="/JenayLee/assets/js/2.e4f0e558.js"><link rel="prefetch" href="/JenayLee/assets/js/20.bc5d540f.js"><link rel="prefetch" href="/JenayLee/assets/js/3.7e9ddeec.js"><link rel="prefetch" href="/JenayLee/assets/js/4.ce52c57f.js"><link rel="prefetch" href="/JenayLee/assets/js/5.02a62bd5.js"><link rel="prefetch" href="/JenayLee/assets/js/6.32ad42f2.js"><link rel="prefetch" href="/JenayLee/assets/js/7.9cb18285.js"><link rel="prefetch" href="/JenayLee/assets/js/8.59beca3f.js"><link rel="prefetch" href="/JenayLee/assets/js/9.758c4a01.js">
    <link rel="stylesheet" href="/JenayLee/assets/css/0.styles.fbf7ff69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JenayLee/" class="home-link router-link-active"><!----> <span class="site-name">Jenay Lee</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JenayLee/dist/notes/frontEnd/checking.html" class="nav-link">Notes</a></div><div class="nav-item"><a href="/JenayLee/dist/about/" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/JenayLee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JenayLee/dist/notes/frontEnd/checking.html" class="nav-link">Notes</a></div><div class="nav-item"><a href="/JenayLee/dist/about/" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/JenayLee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/JenayLee/dist/notes/frontEnd/checking.html" class="sidebar-link">自检清单</a></li><li><a href="/JenayLee/dist/notes/frontEnd/promise.html" class="sidebar-link">Promise</a></li><li><a href="/JenayLee/dist/notes/frontEnd/webpack.html" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#entry" class="sidebar-link">entry</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#output" class="sidebar-link">output</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#devserver" class="sidebar-link">devServer</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#optimization" class="sidebar-link">optimization</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#hmr" class="sidebar-link">HMR</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#pwa" class="sidebar-link">PWA</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#code-split" class="sidebar-link">code split</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#tree-shaking" class="sidebar-link">tree shaking</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#source-map" class="sidebar-link">source-map</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#懒加载-预加载" class="sidebar-link">懒加载/预加载</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#js兼容性处理" class="sidebar-link">js兼容性处理</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#css兼容性处理" class="sidebar-link">css兼容性处理</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#开发环境优化" class="sidebar-link">开发环境优化</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#生产环境优化" class="sidebar-link">生产环境优化</a></li><li class="sidebar-sub-header"><a href="/JenayLee/dist/notes/frontEnd/webpack.html#webpack5" class="sidebar-link">webpack5</a></li></ul></li><li><a href="/JenayLee/dist/notes/frontEnd/axios.html" class="sidebar-link">Axios</a></li><li><a href="/JenayLee/dist/notes/frontEnd/vue.html" class="sidebar-link">Vue</a></li><li><a href="/JenayLee/dist/notes/frontEnd/react.html" class="sidebar-link">React</a></li><li><a href="/JenayLee/dist/notes/frontEnd/angular.html" class="sidebar-link">Angular</a></li><li><a href="/JenayLee/dist/notes/frontEnd/mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/JenayLee/dist/notes/frontEnd/flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/JenayLee/dist/notes/frontEnd/optimize.html" class="sidebar-link">优化</a></li><li><a href="/JenayLee/dist/notes/frontEnd/async.html" class="sidebar-link">异步编程</a></li><li><a href="/JenayLee/dist/notes/frontEnd/tcp.html" class="sidebar-link">TCP协议</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>后端</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/JenayLee/dist/notes/backEnd/C.html" class="sidebar-link">Java</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack">webpack</h1> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * webpack的配置文件
 * * 所有构建工具都是基于nodejs平台运行的，模块化默认采用commonjs
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> WorkboxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> commonCssLoader <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment">// 'style-loader',</span>
    <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            publicPath<span class="token punctuation">:</span> <span class="token string">'../'</span>  <span class="token comment">// 解决css中图片路径问题</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 将js中的css提取，取代style-loader</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            ident<span class="token punctuation">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">plugins</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token comment">// postcss的插件</span>
                <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开发环境和生产环境的差别</span>
    <span class="token comment">// 开发环境：能让代码本地调试运行的环境。源码（es6，less, etc.） -&gt; webpack -&gt; bundle (自动化)</span>
    <span class="token comment">// 生产环境：能让代码优化上线运行的环境。css -&gt; js（闪屏，大 -&gt; 提取）；代码压缩；样式和js兼容</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    <span class="token comment">// mode: 'production',</span>
    entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输出文件资源目录</span>
        path<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定名称+目录</span>
        filename<span class="token punctuation">:</span> <span class="token string">'bundle.[contenthash].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 在package.json中eslintConfig --&gt; airbnb</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token punctuation">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
                <span class="token comment">// 优先执行</span>
                enforce<span class="token punctuation">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>  <span class="token comment">// post 延后执行</span>
                options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 自动修复</span>
                    fix<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// 以下loader只会匹配一个</span>
                <span class="token comment">// 优化生产环境构建打包速度</span>
                <span class="token comment">// 注意：不能有两个配置处理同一个类型文件</span>
                oneOf<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token comment">// less-loader 将less文件编译成css文件</span>
                    <span class="token comment">// css-loader 将css文件变成commonjs模块加载js中，内容是样式字符串</span>
                    <span class="token comment">// style-loader 创建style标签，将js中的样式资源插入，添加到head中生效</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|jpeg|gif)/</span><span class="token punctuation">,</span>
                        loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 图片大小小于8kb，就会被base64处理</span>
                            <span class="token comment">// 优点：减少请求数量（减轻服务器压力）</span>
                            <span class="token comment">// 缺点：图片体积会更大（文件请求速度更慢）</span>
                            limit<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
                            <span class="token comment">// 问题：因为url-loader默认使用es6模块化解析，而html-loader引入图片是commonjs</span>
                            <span class="token comment">// 解析时会出问题：[object Module]</span>
                            <span class="token comment">// 解决：关闭url-loader的es6模块化，使用commonjs解析</span>
                            esModule<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

                            <span class="token comment">// 给图片进行重命名</span>
                            <span class="token comment">// [hash:10] 取图片hash的前10位</span>
                            <span class="token comment">// [ext] 取文件原来的扩展名</span>
                            name<span class="token punctuation">:</span> <span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                            outputPath<span class="token punctuation">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.html/</span><span class="token punctuation">,</span>
                        <span class="token comment">// 处理html文件中的img图片（负责引入img，从而能被url-loader进行处理）</span>
                        loader<span class="token punctuation">:</span> <span class="token string">'html-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token comment">// {</span>
                    <span class="token comment">//     exclude: /\.(css|html|js|less)/,</span>
                    <span class="token comment">//     loader: 'file-loader'</span>
                    <span class="token comment">// }</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.(ttf|eot|woff|woff2|svg)$/i</span><span class="token punctuation">,</span>
                        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                            loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                name<span class="token punctuation">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span>
                                outputPath<span class="token punctuation">:</span> <span class="token string">'fonts'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token punctuation">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
                        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                            <span class="token comment">/**
                             * 开启多进程打包
                             * * 进程启动大概为600ms，进程通信也有开销
                             * * 只有工作消耗时间比较长，才需要多进程打包
                             */</span>
                            <span class="token punctuation">{</span>
                                loader<span class="token punctuation">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                                options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                    workers<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">// 进程2个</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{</span>
                                loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                                options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                    <span class="token comment">// 预设：指示babel做怎样的兼容性处理</span>
                                    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                        <span class="token punctuation">[</span>
                                            <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                                            <span class="token punctuation">{</span>
                                                <span class="token comment">// 按需加载</span>
                                                useBuiltIns<span class="token punctuation">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                                                <span class="token comment">// 指定core-js版本</span>
                                                corejs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                                    version<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                <span class="token comment">// 指定兼容性做到哪个版本浏览器</span>
                                                targets<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                                    chrome<span class="token punctuation">:</span> <span class="token string">'60'</span><span class="token punctuation">,</span>
                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token comment">// 开启babel缓存</span>
                                    <span class="token comment">// 第二次构建时，会读取之前的缓存</span>
                                    cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token punctuation">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            <span class="token comment">// 压缩</span>
            minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// 去空格</span>
                collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// 删注释</span>
                removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 提取css</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token punctuation">:</span> <span class="token string">'css/main.[contenthash].css'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 压缩css</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 1. 帮助serviceworker快速启动 2. 删除旧的serviceworker</span>
            <span class="token comment">// 生成一个serviceworker配置文件</span>
            clientClaim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            skipWaiting<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 开发服务器devServer：用来自动化（自动编译，自动打开浏览器，自动刷新浏览器）</span>
    <span class="token comment">// 特点：只会在内存中编译打包，不会有任何输出</span>
    <span class="token comment">// 启动devServer指令为：npx webpack-dev-server</span>
    devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 项目构建后路径</span>
        contentBase<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 启动gzip压缩</span>
        compress<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 端口号</span>
        port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
        <span class="token comment">// 自动打开浏览器</span>
        open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// HMR</span>
        hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置某些包不参与打包</span>
    externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        jquery<span class="token punctuation">:</span> <span class="token string">'jQuery'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="entry">entry</h2> <ul><li><p>1.1  单入口（string）</p> <ul><li><code>'./src/index.js'</code></li> <li>打包形成一个chunk，输出一个bundle文件，此时chunk的名称默认是main</li></ul></li> <li><p>1.2 多入口（array）</p> <ul><li><code>['./src/index.js', './src/add.js']</code></li> <li>所有入口文件最终只会形成一个chunk，输出一个bundle文件</li> <li>只有在HMR功能中让html热更新生效</li></ul></li> <li><p>1.3 多入口（object）</p> <ul><li><code>{index: './src/index.js', add: './src/add.js'}</code> 或 <code>{index: ['./src/index.js', './src/count.js'], add: './src/add.js'}</code></li> <li>有几个入口文件就形成几个chunk，输出几个bundle文件。此时chunk的名称是key值</li></ul></li></ul> <h2 id="output">output</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输出文件资源目录</span>
        path<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定名称+目录</span>
        filename<span class="token punctuation">:</span> <span class="token string">'js/[name].js'</span><span class="token punctuation">,</span>
        <span class="token comment">//所有资源引入公共路径前缀</span>
        publicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token comment">// 非入口chunk的名称</span>
        chunkFilename<span class="token punctuation">:</span> <span class="token string">'js/[name]_chunk.js'</span><span class="token punctuation">,</span>
        libraray<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>  <span class="token comment">// 整个库向外暴露的变量名</span>
        <span class="token comment">// libraray: 'window',  // 变量名添加到browser</span>
        <span class="token comment">// libraray: 'global',  // 变量名添加到node</span>
        <span class="token comment">// libraray: 'commonjs/amd'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="devserver">devServer</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 运行代码的目录</span>
    contentBase<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 监视contentBase目录下的所有文件，一旦文件变化就回reload</span>
    watchContentBase<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    watchOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 忽略文件</span>
        ignored<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 启动gzip压缩</span>
    compress<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口</span>
    port<span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
    <span class="token comment">// 域名</span>
    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token comment">// 开启HMR</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 不要显示启动服务器日志信息</span>
    clientLogLevel<span class="token punctuation">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
    <span class="token comment">// 除了一些基本启动信息以外，其他内容都不要显示</span>
    quiet<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 如果出错，不要全屏提示</span>
    overlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 服务器代理：解决开发环境跨越问题</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 一旦（5000）服务器接收到/api/xxx请求，就会把请求转发到另一个服务器（3000）</span>
            target<span class="token punctuation">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>
            <span class="token comment">// 发送请求时，请求路径重写： 将/api/xxx --&gt; /xxx （去掉/api）</span>
            pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'^/api'</span><span class="token punctuation">:</span> <span class="token string">''</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="optimization">optimization</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
        <span class="token comment">// 以下配置为默认值，可不写</span>
        <span class="token comment">// minSize: 30 * 1024, // 分割的chunk最小为30kb</span>
        <span class="token comment">// maxSize: 0, // 最大没有限制</span>
        <span class="token comment">// minChunks: 1, // 要提取的chunk最小被引用1次</span>
        <span class="token comment">// maxAsyncRequests: 5, // 按需加载试并行加载的文件最大数量</span>
        <span class="token comment">// maxInitialRequests: 3, // 入口js文件最大并行请求数量</span>
        <span class="token comment">// automaticNameDelimiter: '~', // 名称连接符</span>
        <span class="token comment">// name: true， // 可以使用命名规则</span>
        <span class="token comment">// cacheGroups: {</span>
        <span class="token comment">//     // 分割chunk的组</span>
        <span class="token comment">//     // node_modules文件会被打包到vendors组的chunk中 --&gt; vendors~xx.js</span>
        <span class="token comment">//     // 满足上面的公共规则，如：大小超过30kb，至少被引用一次</span>
        <span class="token comment">//     vendors: {</span>
        <span class="token comment">//         test: /[\\/]node_modules[\\/]/,</span>
        <span class="token comment">//         // 优先级</span>
        <span class="token comment">//         priority: -10</span>
        <span class="token comment">//     }，</span>
        <span class="token comment">//     default: {</span>
        <span class="token comment">//         // 要提取的chunk最少被引用2次</span>
        <span class="token comment">//         minChunks: 2,</span>
        <span class="token comment">//         // 优先级</span>
        <span class="token comment">//         priority: -20,</span>
        <span class="token comment">//         // 如果当前要打包的模块和之前已经被提取的模块是同一个，就会复用，而不是重新打包模块</span>
        <span class="token comment">//         reuseExistingChunk: true</span>
        <span class="token comment">//     }</span>
        <span class="token comment">// }</span>
    <span class="token punctuation">}</span>，
    <span class="token comment">// 将当前模块记录其他模块的hash单独打包为一个runtime文件</span>
    <span class="token comment">// 解决：修改a文件导致b文件的contenthash变化</span>
    runtimeChunk<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">name</span><span class="token punctuation">:</span> <span class="token parameter">entrypoint</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`runtime-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entrypoint<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>，
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 配置生产环境的压缩方案：js和css</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 开启缓存</span>
            cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">// 开启多进程打包</span>
            parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">// 启动source-map</span>
            sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="缓存">缓存</h2> <ul><li>babel缓存
<ul><li>让第二次打包构建速度更快</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li>文件资源缓存（让代码上线远行缓存更好使用）
<ul><li>hash：每次webpack构建时会生成一个唯一的hash值
<ul><li>问题：因为js和css同时会使用一个hash值，如果重新打包，会导致所有缓存失效（可能只改动一个文件）</li></ul></li> <li>chunkhash：根据chunk生成的hash值，如果打包来源于同一个chunk，那么hash值就一样
<ul><li>问题：js和css的hash值还是一样的，因为css是在js中被引入的，所以同属于一个chunk</li></ul></li> <li>contenthash（推荐）：根据文件的内容生成hash值，不同文件hash值一定不一样</li></ul></li></ul> <h2 id="hmr">HMR</h2> <p>hot module replacement 热模块替换/模块热替换</p> <p>作用：一个模块发生变化：只会重新打包这一个模块，而不是打包所有模块 -&gt; 极大提升构建速度</p> <ul><li>样式文件：支持HMR，因为style-loader内部实现了</li> <li>js文件：不支持HMR，需要修改js代码，添加支持HMR功能的代码<div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">{</span>
        module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./print.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>注意：HMR功能对js的处理，只能处理非入口js文件的其他文件</li></ul></li> <li>html文件：不支持HMR (不用做HMR功能)
<ul><li>解决：修改entry入口，将html文件引入，会导致html文件不能热更新</li></ul></li></ul> <h2 id="pwa">PWA</h2> <p>渐进式网络开发应用程序（离线可访问）</p> <ul><li>workbox --&gt; workbox-webpack-plugin</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 1. 帮助serviceworker快速启动 2. 删除旧的serviceworker</span>
            <span class="token comment">// 生成一个serviceworker配置文件</span>
            clientClaim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            skipWaiting<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre></div><ul><li>在入口文件中配置，必须在服务器运行</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// 注册serviceworker（处理兼容性问题）</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            navigator<span class="token punctuation">.</span>serviceworker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="code-split">code split</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>可以将node_modules中代码单独打包一个chunk最终输出</li> <li>自动分析多入口chunk中有没有公共的文件，如果有会打包成单独一个chunk
<ul><li>通过js代码，让某个文件被单独打包成一个chunk</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// import动态导入语法：能将某个文件单独打包</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'test'*/</span><span class="token string">&quot;./test&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>fun1<span class="token punctuation">,</span> fun2<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="tree-shaking">tree shaking</h2> <p>去除无用代码</p> <ul><li>前提：1. 必须使用es6模块化  2. 开启production环境</li> <li>作用：减少代码体积</li> <li>在package.json中配置
<ul><li><code>&quot;sideEffects&quot;: false</code>  所有代码都没有副作用（都可以进行tree shaking）</li> <li>问题：可能会把css / @babel/polyfill 等文件干掉</li> <li>解决：<code>&quot;sideEffects&quot;: [&quot;*.css&quot;, &quot;*.less&quot;]</code></li></ul></li></ul> <h2 id="source-map">source-map</h2> <p>一种提供源代码构建后代码映射技术</p> <p>如果构建后代码出错了，通过映射可以追踪代码错误</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span>
</code></pre></div><p>-<code>[inline-|hidden-|eval-][nosource-][cheap-[module-]]source-map</code></p> <p>区别：外部生成了map文件，内联没有；内联构建速度更快</p> <ul><li><ol><li><code>source-map</code>: 外部</li></ol> <ul><li>错误代码准备信息 &amp; 源代码的错误位置</li></ul></li> <li><ol start="2"><li><code>inline-source-map</code>：内联</li></ol> <ul><li>只生成一个内联source-map</li> <li>错误代码准备信息 &amp; 源代码的错误位置</li></ul></li> <li><ol start="3"><li><code>hidden-source-map</code>：外部</li></ol> <ul><li>错误代码错误原因 &amp; 没有错误位置</li> <li>不能追踪源代码错误，只能提示到构建后代码的错误位置</li></ul></li> <li><ol start="4"><li><code>eval-source-map</code>：内联</li></ol> <ul><li>每一个文件都生成对应的source-map，都在eval中</li> <li>错误代码准确信息 &amp; 源代码的错误位置</li></ul></li> <li><ol start="5"><li><code>nosource-source-map</code>：外部</li></ol> <ul><li>错误代码准确信息 &amp; 但是没有任何源代码信息</li></ul></li> <li><ol start="6"><li><code>cheap-source-map</code>：外部</li></ol> <ul><li>错误代码错误原因 &amp; 源代码的错误位置</li> <li>只能精确到行</li></ul></li> <li><ol start="7"><li><code>cheap-module-source-map</code>：外部</li></ol> <ul><li>错误代码准确信息 &amp; 源代码的错误位置</li> <li>module会将loader的source-map加入</li></ul></li> <li><p>开发环境：速度快，调试更友好</p> <ul><li>速度快 eval &gt; inline &gt; cheap &gt; ...
<ul><li><code>eval-cheap-source-map</code> / <code>eval-source-map</code></li></ul></li> <li>调试更友好
<ul><li>source-map | cheap-module-source-map | cheap-source-map</li> <li><code>eval-source-map</code> / <code>eval-cheap-module-source-map</code></li></ul></li></ul></li> <li><p>生产环境：源代码要不要隐藏？调试要不要更友好</p> <ul><li>内联会让代码体积变大，所以在生产环境不用内联
<ul><li><code>nosource-source-map</code> 全部隐藏</li> <li><code>hidden-source-map</code> 只隐藏源代码，会提示错误位置</li></ul></li> <li><code>source-map</code> / <code>cheap-module-source-map</code></li></ul></li></ul> <h2 id="懒加载-预加载">懒加载/预加载</h2> <ul><li>懒加载：当文件需要使用时才加载（使用import动态导入）</li> <li>预加载prefetch：会在使用之前，提前加载js文件
<ul><li>等其他资源加载完毕后再加载</li> <li>存在兼容性问题，慎用</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// import动态导入语法：能将某个文件单独打包</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'test' , webpackPrefetch: true*/</span><span class="token string">&quot;./test&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>fun1<span class="token punctuation">,</span> fun2<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>正常加载：可以认为是并行加载（同一时间加载多个文件）</li></ul> <h2 id="js兼容性处理">js兼容性处理</h2> <p><code>babel-loader @babel/core</code></p> <ul><li><p>eslint处理</p> <ul><li>正常来讲，一个文件只能被一个loader处理</li> <li>当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：
<ul><li>先执行eslint 再执行babel</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// webpack.config.js</span>
    <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
        <span class="token comment">// 优先执行</span>
        enforce<span class="token punctuation">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 自动修复</span>
            fix<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// package.json</span>
    <span class="token string">&quot;eslintConfig&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;extends&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;airbnb-base&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;env&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;browser&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token comment">// 支持浏览器的全局变量</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>基本js兼容性处理： <code>@babel/preset-env</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>     <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 预设：指示babel做怎样的兼容性处理</span>
            presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                    <span class="token string">'@babel/preset-env'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre></div><ul><li>问题：只能转换基本语法，如promise高级语法不能转换</li></ul></li> <li><p>全部js兼容性处理： <code>@babel/polyfill</code>  通过import引入</p> <ul><li>问题：只能解决部分兼容性问题，但所有兼容性代码会全部引入，体积太大了</li></ul></li> <li><p>按需加载： <code>core-js</code></p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 预设：指示babel做怎样的兼容性处理</span>
            presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                    <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token comment">// 按需加载</span>
                        useBuiltIns<span class="token punctuation">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                        <span class="token comment">// 指定core-js版本</span>
                        corejs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            version<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token comment">// 指定兼容性做到哪个版本浏览器</span>
                        targets<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            chrome<span class="token punctuation">:</span> <span class="token string">'60'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="css兼容性处理">css兼容性处理</h2> <p><code>postcss -&gt; postcss-loader postcss-preset-env</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 帮postcss找到package.json中browserslist里面的配置，通过配置加载指定的css兼容性样式</span>
<span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        ident<span class="token punctuation">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">plugins</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token comment">// postcss的插件</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>browserslist默认选中生产环境，可通过node环境变量调整：<code>process.env.NODE_ENV = &quot;development&quot;</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// package.json</span>
<span class="token string">&quot;browserslist&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;development&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;last 1 chrome version&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;last 1 firefox version&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;last 1 safari version&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;production&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;&gt;0.2%&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;not dead&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;not op_mini all&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="开发环境优化">开发环境优化</h2> <ul><li><p>优化打包构建速度</p> <ul><li><a href="#hmr">HMR</a></li></ul></li> <li><p>优化代码调试</p> <ul><li><a href="#source-map">source-map</a></li></ul></li></ul> <h2 id="生产环境优化">生产环境优化</h2> <ul><li><p>优化打包构建速度</p> <ul><li>oneOf</li> <li><a href="#缓存">babel缓存</a></li> <li>多进程打包</li> <li>externals</li> <li>dll</li></ul></li> <li><p>优化代码运行性能</p> <ul><li><a href="#缓存">缓存（hash-chunkhash-contenthash)</a></li> <li><a href="#tree-shaking">tree shaking</a></li> <li><a href="#code-split">code split</a></li> <li><a href="#懒加载-预加载">懒加载/预加载</a></li> <li><a href="#pwa">pwa</a></li></ul></li></ul> <h2 id="webpack5">webpack5</h2> <p>此版本重点关注以下内容：</p> <ul><li>通过持久缓存提高构建性能</li> <li>使用更好的算法和默认值来改善长期缓存</li> <li>通过更好的树摇和代码生成来改善捆绑包大小</li> <li>清除处于怪异状态的内部结构，同时在V4中实现功能而不引入任何重大更改</li> <li>通过引入重大更改来为将来的功能做准备，以便使我们能够尽可能长时间地使用V5</li></ul> <h4 id="下载">下载</h4> <p><code>npm i webpack@next webpack-cli -D</code></p> <h4 id="自动删除node-js-polyfills">自动删除Node.js Polyfills</h4> <p>早期，webpack的目标是允许在浏览器中运行大多数node.js模块，但是模块格局发生了变化，许多模块用途现在主要是为了前端目的而编写的。webpack &lt;= 4 附带了许多node.js核心模块的polyfill，一旦模块使用任何核心模块（即crypro模块），这些模块就会自动应用。</p> <p>尽管这使使用为node.js编写的模块变得容易，但它会将这些巨大的polyfill添加到包中。在许多情况下，这些polyfill是不必要的。</p> <p>webpack 5 会自动停止填充这些核心模块，并专注于与前端兼容的模块。</p> <p>迁移：</p> <ul><li>尽可能尝试使用与前端兼容的模块</li> <li>可以为node.js核心模块手动添加一个polyfill，错误信息将提示如何实现该目标</li></ul> <h4 id="chunk和模块id">Chunk和模块ID</h4> <p>添加了用于长期缓存的新算法，在生产模式下默认启用这些功能</p> <p><code>chunkIds: 'deterministic', moduleIds: 'deterministic'</code></p> <h4 id="chunk-id">Chunk ID</h4> <p>你可以不用使用<code>import(/* webpackChunkName: &quot;name&quot; */ &quot;module&quot;)</code>在开发环境来为chunk命名，生产环境还是有必要的。webpack内部有chunk命名规则，不再是以id(0,1,2)命名了</p> <h4 id="tree-shaking-2">Tree Shaking</h4> <ol><li>webpack5能够处理对嵌套模块的tree shaking</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// inner.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// module.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> inner <span class="token keyword">from</span> <span class="token string">'./inner'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> inner <span class="token punctuation">}</span>

<span class="token comment">// user.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module <span class="token keyword">from</span> <span class="token string">'./module'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>inner<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在生产环境中，inner模块暴露的<code>b</code>会被删除</p> <ol start="2"><li>webpack5能够处理多个模块之前的关系</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> something <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./something'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">usingSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">usingSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当设置<code>'sideEffects': false</code>时，一旦发现<code>test</code>方法没有使用，不但删除<code>test</code>，还会删除<code>'./something'</code></p> <ol start="3"><li>webpack5能处理对Commonjs的tree shaking</li></ol> <h4 id="output-2">Output</h4> <p>webpack 4 默认只能输出ES5代码</p> <p>webpack 5 开始新增一个属性<code>output.ecmaVersion</code>，可以生成ES5和ES6/ES2015代码</p> <p>如：<code>output.ecmaVersion: 2015</code></p> <h4 id="splitchunk">SplitChunk</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// webpack 4</span>
miniSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">;</span>

<span class="token comment">// webpack 5</span>
miniSize<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    javascript<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> <span class="token number">50000</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="caching">Caching</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 配置缓存</span>
cache<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 磁盘存储</span>
    type<span class="token punctuation">:</span> <span class="token string">&quot;filesystem&quot;</span><span class="token punctuation">,</span>
    buildDependencies<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当配置修改时，缓存失效</span>
        config<span class="token punctuation">:</span> <span class="token punctuation">[</span>__filename<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缓存将存储到<code>node_modules/.cache/webpack</code></p> <h4 id="监视输出文件">监视输出文件</h4> <p>之前webpack总是在第一次构建时输出全部文件，但是监视重新构建时会只更新修改的文件。此次更新在第一次构建时会找到输出文件看是否有变化，从而决定要不要输出全部文件。</p> <h4 id="默认值">默认值</h4> <ul><li><code>entry: &quot;./src/index.js&quot;</code></li> <li><code>output.path: path.resolve(__dirname, &quot;dist&quot;)</code></li> <li><code>output.filename: &quot;[name].js</code></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/JenayLee/dist/notes/frontEnd/promise.html" class="prev">
          Promise
        </a></span> <span class="next"><a href="/JenayLee/dist/notes/frontEnd/axios.html">
          Axios
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/JenayLee/assets/js/app.0b41792d.js" defer></script><script src="/JenayLee/assets/js/19.f0c3d88c.js" defer></script>
  </body>
</html>
